(()=>{var s="normal",d={NORMAL:"normal",INSERT:"insert",VISUAL:"visual"},i=80,m=10,x=!1,g=null;function R(){return x||g||(g=import(globalThis.chrome&&chrome.runtime&&chrome.runtime.getURL?chrome.runtime.getURL("js/dist/search_ui.js"):"/js/dist/search_ui.js").then(t=>{try{t.initSearchUI?.()}catch{}return x=!0,t})),g}var A={immediate:[{key:"i",mode:"normal",description:"Enter insert mode",handler:()=>(s=d.INSERT,!0)},{key:"ffq",mode:"normal",description:"Open search panel",handler:e=>(R().then(t=>t.openSearchPanel?.()),!0)},{key:"h",mode:"normal",description:"Scroll left",handler:e=>{let t=!!e?.repeat,n=t?Math.max(1,i-m):i,r=t?"auto":"smooth";return window.scrollBy({left:-n,behavior:r}),!0}},{key:"j",mode:"normal",description:"Scroll down",handler:e=>{let t=!!e?.repeat,n=t?Math.max(1,i-m):i,r=t?"auto":"smooth";return window.scrollBy({top:n,behavior:r}),!0}},{key:"k",mode:"normal",description:"Scroll up",handler:e=>{let t=!!e?.repeat,n=t?Math.max(1,i-m):i,r=t?"auto":"smooth";return window.scrollBy({top:-n,behavior:r}),!0}},{key:"l",mode:"normal",description:"Scroll right",handler:e=>{let t=!!e?.repeat,n=t?Math.max(1,i-m):i,r=t?"auto":"smooth";return window.scrollBy({left:n,behavior:r}),!0}},{key:"C-j",mode:"normal",description:"Ctrl+J example",handler:e=>!0},{key:["C-j","j"],mode:"normal",description:"Demo: Ctrl+J then j",handler:e=>!0},{key:["C-j","k"],mode:"normal",description:"Demo: Ctrl+J then Ctrl+K",handler:()=>!0},{key:"C-d",mode:"normal",description:"Page down",handler:e=>{let t=!!e?.repeat,n=Math.max(1,Math.floor(window.innerHeight*.9)),r=t?Math.max(1,n-m):n,o=t?"auto":"smooth";return window.scrollBy({top:r,behavior:o}),!0}},{key:"C-u",mode:"normal",description:"Page up",handler:e=>{let t=!!e?.repeat,n=Math.max(1,Math.floor(window.innerHeight*.9)),r=t?Math.max(1,n-m):n,o=t?"auto":"smooth";return window.scrollBy({top:-r,behavior:o}),!0}},{key:"gg",mode:"normal",description:"Go to top of document",handler:e=>{let t=e?.repeat?"auto":"smooth";return window.scrollTo({top:0,behavior:t}),!0}},{key:"S-g",mode:"normal",description:"Go to bottom of document",handler:e=>{let t=e?.repeat?"auto":"smooth",n=document.scrollingElement||document.documentElement||document.body;return window.scrollTo({top:n.scrollHeight,behavior:t}),!0}}]},c={IDLE:"idle",PREFIX:"prefix",PENDING_EXACT:"pendingExact"},p=2,_=new Array(2),u=0,h=0,I=500,k=null,S=c.IDLE,f=null;function y(){k&&(clearTimeout(k),k=null)}function E(){S=c.IDLE,f=null}function w(e,t){y(),S=e,f=t||null,k=setTimeout(()=>{if(S===e&&f)try{f()}catch{}M(),E(),y()},I)}function N(){if(S===c.PENDING_EXACT&&f){let e=f;y(),E();try{e()}catch{}}}function D(e){if(Array.isArray(e))return e.slice();let t=String(e);if(t.includes(" "))return t.trim().split(/\s+/);if(t.includes("-")){let n=t.split("-"),r=0,o=[];for(;r<n.length&&(n[r]==="C"||n[r]==="S");)o.push(n[r]),r++;if(r<n.length){let a=n[r++],l=(o.length?o.join("-")+"-":"")+a,b=n.slice(r);return[l,...b]}return[t]}return t.split("")}function j(e){let t={children:new Map,handler:null},n=1;for(let r of e){let o=D(r.key);n=Math.max(n,o.length);let a=t;for(let l of o)a.children.has(l)||a.children.set(l,{children:new Map,handler:null}),a=a.children.get(l);a.handler=r.handler}return{root:t,maxLen:n}}var{root:P,maxLen:O}=j(A.immediate);p=Math.max(1,O);_=new Array(p);function U(e){return e&&(e.tagName==="INPUT"||e.tagName==="TEXTAREA"||e.isContentEditable)}function V(e,t){let n=e.key;if(n==="Shift"||n==="Control"||n==="Alt"||n==="Meta")return null;let r=n.length===1?n.toLowerCase():n;if(!t)return r;let o=[];return e.ctrlKey&&o.push("C"),e.shiftKey&&o.push("S"),o.length?o.join("-")+"-"+r:r}function M(){u=0,h=0}function X(e){h<p?(_[(u+h)%p]=e,h++):(_[u]=e,u=(u+1)%p)}function B(e){u=0,h=1,_[0]=e}function L(){let e=P,t=null;for(let n=0;n<h;n++){let r=_[(u+n)%p],o=e.children.get(r);if(!o)return{type:"none",lastExact:t};e=o,e.handler&&(t={handler:e.handler,depth:n+1})}return e.handler?{type:"exact",handler:e.handler,hasChildren:e.children.size>0}:e.children.size>0?{type:"prefix",lastExact:t}:{type:"none",lastExact:t}}var K=e=>{let t=V(e,h===0);if(!t)return!1;X(t);let n=L();switch(n.type){case"exact":{if(y(),E(),n.hasChildren)return w(c.PENDING_EXACT,n.handler),!0;try{n.handler(e)}catch{}return M(),!0}case"prefix":{let r=n.lastExact;return w(c.PREFIX,r?.handler||null),!0}case"none":default:break}switch(N(),B(t),n=L(),n.type){case"exact":{if(y(),E(),n.hasChildren)return w(c.PENDING_EXACT,n.handler),!0;try{n.handler(e)}catch{}return M(),!0}case"prefix":return w(c.PREFIX,null),!0;case"none":default:break}return y(),E(),M(),!1},q=e=>{e.key==="Escape"&&(s=d.NORMAL,e.preventDefault())},T=e=>{switch(s){case d.NORMAL:{if(globalThis.__wer_search_open)return;e.preventDefault(),K(e);break}case d.INSERT:q(e);break;default:break}},C=e=>{switch(s){case d.NORMAL:{let t=e.target;U(t)&&(s=d.INSERT);break}case d.INSERT:break;default:break}};var v="__wer_bootstrap_installed";if(!globalThis[v]){globalThis[v]=!0,document.addEventListener("keydown",T,{capture:!0}),document.addEventListener("click",C,{capture:!0});let e=!1,t=null,n=async()=>(e||t||(t=import(globalThis.chrome&&chrome.runtime&&chrome.runtime.getURL?chrome.runtime.getURL("js/dist/vim_display.js"):"/js/dist/vim_display.js").then(l=>{try{l.initVimDisplay?.()}catch{}return e=!0,l})),t),r=()=>{n().then(a=>a.syncVimDisplay?.(s))},o=()=>{n().then(a=>a.syncVimDisplay?.(s))};document.addEventListener("keydown",r,{capture:!1}),document.addEventListener("click",o,{capture:!1}),chrome.runtime.onMessage.addListener(async a=>{a?.action==="cleanup"&&(document.removeEventListener("keydown",T,{capture:!0}),document.removeEventListener("click",C,{capture:!0}),document.removeEventListener("keydown",r,{capture:!1}),document.removeEventListener("click",o,{capture:!1}),e&&t?.then(l=>l.cleanupVimDisplay?.()))})}})();
